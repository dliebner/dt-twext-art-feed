var portl=portl||{};portl.cmd=portl.cmd||[];var PATH_TO_WEB_ROOT="https://domo.town/";portl.loaded||(portl.loaded=!0,async function(){const t=[import("./lit-all.min.js"),import("./immer.production.mjs"),import("./bundle.js")],[e,s,{preactSignals:r,SignalWatcher:i,avatarGradient:o}]=await Promise.all(t),{LitElement:a,html:n,unsafeHTML:l,css:h,unsafeCSS:c,classMap:d,styleMap:m,ifDefined:u,Directive:p,AsyncDirective:f}=e,[g,v]=function(){const t=new Map;return[function(s){const r=e.directive(s);return t.set(r,s),r},function(s){return t.get(s)??e.getDirectiveClass(s)}]}(),b=(t="")=>n`
				<svg class="checkmark ${t}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" stroke="#4caf50" strokeWidth="5" strokeMiterlimit="10"><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
			`;class y{static mutate(t,e){return s.produce(t,e)}static arrayRemove(t,e){const s=t.indexOf(e);if(s>=0)return t.splice(s,1),!0}static forOwn(t,e){Object.keys(t).forEach((s=>{e(s,t[s],t)}))}static getDuckTypedDescendants(t,e,s=!0){const r=[],i=o=>{if(o===t||!(e in o)||(r.push(o),!s))for(const t of o.childNodes)i(t)};return i(t),r}static seedRandom=(t,e=1,s=0)=>("number"!=typeof t&&(t=(t=>{var e,s=0;if(0===t.length)return s;for(e=0;e<t.length;e++)s=(s<<5)-s+t.charCodeAt(e),s|=0;return s<0&&(s=-s),s})(t+"")),s+(t=(9301*t+49297)%233280)/233280*(e-s));static resizeObserverEntryToDimensions(t){let e,s;if(t.borderBoxSize)e=t.borderBoxSize[0].inlineSize,s=t.borderBoxSize[0].blockSize;else{const r=t.target.getBoundingClientRect();e=r.width,s=r.height}return[e,s]}}class E{static stopDefault(t){if(t)return t.preventDefault(),window.getSelection&&window.getSelection()?.removeAllRanges(),!1}static ajax(t,e){"function"==typeof e&&(e={success:e});e=Object.assign({ignoreAborted:!0},e);const s=function(r=0){const i=$.extend(!0,{},e);i.data=i.data||{};const o=X.token;let a;if("object"==typeof i.data?Array.isArray(i.data)?i.data.push({name:"twitchToken",value:o}):i.data.twitchToken=o:"string"==typeof i.data&&(i.data.length>0&&(i.data+="&"),i.data+="twitchToken="+encodeURIComponent(o)),i.form||i.$form||i.data&&Object.values(i.data).some((t=>t instanceof File))){a=!0;const t=i.data;i.data=new FormData(i.form||i.$form?.[0]||void 0),y.forOwn(t,((t,e)=>{i.data.append(t,e)}))}const n=i.formController;if(n){if(0===r){if(n.processing||n.formIsDone)return!1;if(n.clearError(),n.validate(),n.hasErrors())return!1}n.processing=!0,i.error||(i.error=t=>{n.setError(t.message)}),i.formError||(i.formError=t=>{n.processAjaxErrors(t.data.errors)})}const l={url:t,data:i.data,type:"post",dataType:"json",success:function(t){n&&(n.processing=!1),async function(t,e,s,r){const i=t.data;switch(t.status){case"success":"function"==typeof e.success&&e.success(t);break;case"critical":i&&i.sql&&console.log(i.sql),"function"==typeof e.anyError&&e.anyError(t),"function"==typeof e.critical&&e.critical(t),B.create("Critical Error",t.message);break;case"invalidTwitchAuthToken":0===r||r<=1&&y.newTokenIssuedTs&&(new Date).getTime()-y.newTokenIssuedTs<=5e3?(e.cancelComplete=!0,s(r+1)):B.create("Critical Error","Invalid twitch auth token.");break;case"formError":"function"==typeof e.anyError&&e.anyError(t),"function"==typeof e.formError&&e.formError(t);break;case"error":"function"==typeof e.anyError&&e.anyError(t),"function"==typeof e.error?e.error(t):B.create("Error",t.message);break;default:"function"==typeof e.anyError&&e.anyError(t),"function"==typeof e.critical&&(t.message||(t.message="An unknown error has occurred."),e.critical(t)),B.create("Error","An unknown error has occurred.")}}(t,i,s,r)},error:function(t,e,s){n&&(n.processing=!1),i.ignoreAborted&&"abort"===e||("function"==typeof i.anyError&&i.anyError(),"function"==typeof i.ajaxError&&i.ajaxError(t,e,s),B.create("Error","An unknown error has occurred."))},complete:function(t,e){i.cancelComplete||"function"!=typeof i.complete||i.complete(t,e)}};return"function"==typeof i.progress&&(l.xhr=function(){var t,e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(e=>{var s=0,r=e.loaded||e.position,o=e.total;e.lengthComputable&&(s=r/o),"function"==typeof i.progress&&t!==s&&i.progress(s),t=s}),!0),e}),a&&(l.cache=!1,l.contentType=!1,l.processData=!1),$.ajax(l)};return s()}static loadCSS(t){const e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)}static binarySearchArray(t,e,s){return function t(r,i,o){if(i>o)return-1;let a=Math.floor((i+o)/2),n=s(e,r[a]);return 0==n?a:n<0?t(r,i,a-1):t(r,a+1,o)}(t,0,t.length-1)}static dereferenceObject(t){for(const e in t)["object","function"].indexOf(typeof t[e])>=0&&(t[e]=void 0)}static assignOwnProperties(t,e){for(const s of Object.keys(e))s in t&&(t[s]=e[s]);return t}static getScrollParent(t,e=!1){let s=getComputedStyle(t),r="absolute"===s.position,i=e?/(auto|scroll|hidden)/:/(auto|scroll)/;if("fixed"===s.position)return window;for(let e=t;e=e.parentElement;)if(s=getComputedStyle(e),(!r||"static"!==s.position)&&i.test(s.overflow+s.overflowY+s.overflowX))return e;return window}static preloadImgWithPromise(t,e={}){let{tryCrossOriginFirst:s=!1}=e,r=new Image,i=new Promise(((i,o)=>{if(s&&(r.crossOrigin="anonymous"),r.src=t,r.complete)r.naturalWidth?i(r):o(r);else{const a=()=>{if(r.removeEventListener("load",a),r.removeEventListener("error",a),r.naturalWidth)i(r);else if(s){const s={...e};s.tryCrossOriginFirst=!1,this.preloadImgWithPromise(t,s).then(i,o)}else o(r)};r.addEventListener("load",a),r.addEventListener("error",a)}}));return Object.assign(i,{image:r})}static init(){window.location.pathname.endsWith("/panel.html")&&(document.documentElement.classList.add("h-full"),document.body.classList.add("h-full","overflow-hidden")),E.loadCSS("css/sl-light.css"),E.loadCSS("css/sl-dark.css")}}class w extends f{options;static defaultOptions={required:!0};fieldController;defaultErrorMessage(){}isValid(){}customErrorMessage(){const t=this.options.customErrorMessage;return"function"==typeof t?t():t}getError(){if(!this.isValid())return this.customErrorMessage()??this.defaultErrorMessage()}clearErrorOnChange(){if(!this.getError())return this.fieldController.clearError(),!0}render(){return e.nothing}get field(){return this.fieldController?.field}hostReady(){return this.fieldController?.host?.ready()??Promise.reject()}trimmedInput(){return this.fieldController.trimmedValue()}get param(){return this.options.param}set param(t){this.options.param=t}update(t,[e]){return this.options=Object.assign({},this.constructor.defaultOptions,"object"==typeof e?e:{param:e}),this.isConnected&&!this.fieldController&&(this.fieldController=t.element.fieldController,this.fieldController.addValidator(this)),this.render()}disconnected(){this.fieldController?.removeValidator(this),this.fieldController=void 0}}g(class extends w{defaultErrorMessage(){return"This field is required."}isValid(){return"checkbox"===this.field.type?this.field.checked:this.trimmedInput().length>0}}),g(class extends w{defaultErrorMessage(){return"Min length: "+this.param+" characters."}isValid(){return this.trimmedInput().length>=this.param}}),g(class extends w{defaultErrorMessage(){return"Max length: "+this.param+" characters."}isValid(){return this.trimmedInput().length<=this.param}}),g(class extends w{constructor(...t){super(...t),this.options}defaultErrorMessage(){return"Invalid URL."}isValid(){if(!this.trimmedInput()&&!this.options.required)return!0;return(this.options.allowMissingHttps?PatternLib.permissiveUrl:PatternLib.url).test(this.trimmedInput())}});class I{host;form;_submitEvents=[];customValidator;get fields(){const t=this.form?.elements;return Array.from(t??[])}get fieldControllers(){return this.fields?.map((t=>T.getControllerByElement(t))).filter((t=>t))??[]}fieldElement(t){return this.form?.[t]}fieldController(t){const e=this.fieldElement(t);return e?T.getControllerByElement(e):e}constructor(t){this.host=t,t.addController(this)}_formRef=t=>{if(t)for(const e of this._submitEvents)t.addEventListener("submit",e);else for(const t of this._submitEvents)this.form.removeEventListener("submit",t);this.form=t};attach(){return e.ref(this._formRef)}submit(){let t=this.form.querySelector(".hidden-submit");t||(t=document.createElement("input"),t.type="submit",t.classList.add("hidden-submit"),this.form.appendChild(t)),t.click()}_processing=!1;slowProcessing=!1;_slowProcessingTimeoutId;get processing(){return this._processing}set processing(t){this._processing=!!t,this.form?.classList.toggle("processing",this._processing),t?this._slowProcessingTimeoutId=this._slowProcessingTimeoutId??setTimeout((()=>{this.slowProcessing=!0,this.host.requestUpdate()}),75):(clearTimeout(this._slowProcessingTimeoutId),this._slowProcessingTimeoutId=void 0,this.slowProcessing=!1),this.host.requestUpdate()}processAjaxErrors(t,e=[]){const s=Object.fromEntries(e.map((t=>[t,!0])));for(const e of t){if(s[e.field])continue;const t=this.form?.[e.field];if(!t)throw`Unhandled error: field "${e.field}" does not exist`;{const s=T.getControllerByElement(t);s&&s.setError(e.message,void 0,{temporal:!0,dismissalArmingTime:500})}}}_formError;setError(t){this._formError=t,this.host.requestUpdate()}clearError(){this._formError=void 0,this.host.requestUpdate()}clearAllStatesAndEvents(){this.clearError(),this.clearFormDone(),this.clearFormSubmitEvents(),this.customValidator=void 0}renderError(t){if(this._formError){const e=n`
						<div class="form-error border border-rose-600 bg-rose-50 rounded-lg py-2 px-3 mb-4">
							${this._formError}
						</div>
					`;return t?t(this._formError,e):e}}validate(){return this.customValidator?.call(this),this.fieldControllers.forEach((t=>t.validate())),this}hasErrors(){if(this._formError)return!0;const t=this.fieldControllers;for(const e of t)if(e.hasError())return!0;return!1}handleFormSubmit(t,e=!0){const s=s=>{e&&s.preventDefault(),this.processing||this.formIsDone||t(s)};this._submitEvents.push(s),this.form?.addEventListener("submit",s)}clearFormSubmitEvents(){for(const t of this._submitEvents)this.form.removeEventListener("submit",t);this._submitEvents=[]}_changeEvents=["input","change"];formIsDone=!1;markFormDone(t,e){if(this.formIsDone)return;this.formIsDone=!0,this.form.classList.add("done");const s=this.host.querySelector("dt-submit-button");s.done=!0,t&&(this._originalSubmitLabel||(this._originalSubmitLabel=s.label),s.label=t),e?this._delegateClearFormDoneOnInteraction():this._undelegateClearFormDoneOnInteraction()}_delegateClearFormDoneOnInteraction(){this._clearFormDoneOnInteractionDelegated||(this._clearFormDoneOnInteractionDelegated=!0,["focus","change","keydown","keyup"].forEach((t=>{this.form.addEventListener(t,this._clearFormDoneOnInteraction)})))}_undelegateClearFormDoneOnInteraction(){["focus","change","keydown","keyup"].forEach((t=>{this.form.removeEventListener(t,this._clearFormDoneOnInteraction)}))}_clearFormDoneOnInteraction=t=>{t.target.form===this.form&&(this._undelegateClearFormDoneOnInteraction(),this.clearFormDone())};clearFormDone(){if(!this.formIsDone)return;this.formIsDone=!1,this.form.classList.remove("done");const t=this.host.querySelector("dt-submit-button");t.done=!1,this._originalSubmitLabel&&(t.label=this._originalSubmitLabel)}}class T{host;error;errorClass;errorIsTemporal;temporalErrorTimeoutId;errorFadingDuration;temporalErrorMinTimeoutId;temporalErrorDismissalArmingTimeoutId;waitingToFadeTemporalError=!1;errorValidator;validators=[];field;lastInputValue;static _fieldControllerMap=new WeakMap;static getControllerByElement(t){return this._fieldControllerMap.get(t)}trimmedValue(){return this.field?.value.trim()}constructor(t){this.host=t,t.addController(this)}_changeEvents=["input","change"];_handleChangeEvent=t=>{this.errorValidator?.clearErrorOnChange?.(),!this.errorIsTemporal||this.host.value===this.lastInputValue||this.temporalErrorDismissalArmingTimeoutId||this.errorFadingDuration||(this.temporalErrorMinTimeoutId?this.waitingToFadeTemporalError=!0:this.fadeError()),this.lastInputValue=this.host.value};_fieldRef=t=>{t?(T._fieldControllerMap.set(t,this),this._changeEvents.forEach((e=>t.addEventListener(e,this._handleChangeEvent))),this.lastInputValue=this.host.value):(T._fieldControllerMap.delete(this.field),this._changeEvents.forEach((t=>this.field.removeEventListener(t,this._handleChangeEvent))),this.lastInputValue=void 0),this.field=t};attach(){return e.ref(this._fieldRef)}getSiblingController(t){let e=this.field?.form[t];if(e)return T.getControllerByElement(e)}addValidator(t){-1===this.validators.indexOf(t)&&this.validators.push(t)}removeValidator(t){y.arrayRemove(this.validators,t)}getValidatorsByType(t){const e=[];for(const s of this.validators)s instanceof v(t)&&e.push(s);return e}validate(){this.clearError();for(const t of this.validators){let e=t.getError();if(e){this.setError(e,t);break}}return this}setError(t,e,{errorClass:s,temporal:r,fadeDelay:i,minFadeDelay:o,dismissalArmingTime:a}={}){this.error=t,this.errorClass=s,this.errorValidator=e,!0===i&&(i=3e4),(!0===o||i&&void 0===o)&&(o=3e3),i=i?Math.max(i,o??0):o,r||i||a?this.makeErrorTemporal(i,o,a):this.clearTemporalErrorTimeout(),this.host.requestUpdate()}makeErrorTemporal(t,e,s=1500){this.clearTemporalErrorTimeout(),this.errorIsTemporal=!0,t&&(this.temporalErrorTimeoutId=setTimeout((()=>this.fadeError()),t)),e&&(this.temporalErrorMinTimeoutId=setTimeout((()=>{this.temporalErrorMinTimeoutId=void 0,this.waitingToFadeTemporalError&&this.fadeError()}),e)),s&&(this.temporalErrorDismissalArmingTimeoutId=setTimeout((()=>{this.temporalErrorDismissalArmingTimeoutId=void 0}),s))}clearTemporalErrorTimeout(){this.errorIsTemporal=!1,this.errorFadingDuration=void 0,this.waitingToFadeTemporalError=!1;const t=this.temporalErrorTimeoutId;t&&(clearTimeout(t),this.temporalErrorTimeoutId=void 0);const e=this.temporalErrorMinTimeoutId;e&&(clearTimeout(e),this.temporalErrorMinTimeoutId=void 0);const s=this.temporalErrorDismissalArmingTimeoutId;s&&(clearTimeout(s),this.temporalErrorDismissalArmingTimeoutId=void 0)}clearError(){this.clearTemporalErrorTimeout(),this.error=void 0,this.errorValidator=void 0,this.host.requestUpdate()}fadeError(t=400){this.clearTemporalErrorTimeout(),this.temporalErrorTimeoutId=setTimeout((()=>{this.clearError()}),t),this.errorFadingDuration=t,this.host.requestUpdate()}hasError(){return this.error&&!this.errorFadingDuration}errorVisible(){return this.error}fieldErrorClass(){return this.errorVisible()?this.errorClass??"field-error":""}renderError(t){if(this.errorVisible()){if(!0===this.error)return t?.(!0);const e=t=>{const e=this.errorFadingDuration;return n`
							<div
								class="flex transition-opacity ease-in ${e?"opacity-0":"opacity-100"}"
								style="${e?`transition-duration: ${e}ms`:""}"
							>
								${t}
							</div>
						`};if(t)return e(t(this.error));{let t="field-message text-sm";return"checkbox"===this.field.type?e(n`
									<div class="${t} flex items-center mt-1">
										<svg class="stroke-current w-4 h-4 mr-1.5" style="margin-left: .05rem" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
											<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
										</svg>
										${this.error}
									</div>
								`):e(n`
									<div class="${t} mt-2">
										${this.error}
									</div>
								`)}}}}class C{src;width;height;constructor(t,e,s){this.src=s,this.width=t,this.height=e}}class O{sizes;constructor(t){if(this.sizes=[],t&&t.length)for(const e of t)this.addSize(e)}addSize(t){if(this.sizes.length<1)this.sizes.push(t);else{let e=E.binarySearchArray(this.sizes,t,((t,e)=>t.width&&e.width?t.width-e.width:t.height-e.height));e<0&&(e=~e),this.sizes.splice(e,0,t)}}selectSize(t,e){if(e&&this.sizes[0].height){let t=window.devicePixelRatio*e;for(const e of this.sizes)if(e.height>=t)return e;return this.sizes[this.sizes.length-1]}{let e=window.devicePixelRatio*t;for(const t of this.sizes)if(t.width>=e)return t;return this.sizes[this.sizes.length-1]}}}class x{static uploadedMediaDir="media/";static imageTypeDir;static variantWidths;static aspectRatio;static get hdImageTemplate(){if(!this._hdImageTemplate){const t=this.aspectRatio,e=this.variantWidths;if(!e)throw"No variant widths defined";const s=[];e.forEach(((e,r)=>{s.push(new C(e,t?e*t:void 0))})),this._hdImageTemplate=new O(s)}return this._hdImageTemplate}static uploadedMediaRootDir(){return PATH_TO_WEB_ROOT+this.uploadedMediaDir}static imageTypeRootDir(){if(!this.imageTypeDir)throw"imageTypeDir is not defined";return this.uploadedMediaRootDir()+this.imageTypeDir}baseFilename;fileExtensionByVariant={};constructor(t){this.baseFilename=t}addVariant(t="",e){"orig"===t&&(t=""),this.fileExtensionByVariant[t]=e}static _imageDirectory(t){return this.imageTypeRootDir()+t[0]+"/"+t[1]+"/"+t[2]+"/"+t[3]+"/"+t+"/"}imageDirectory(){return this.constructor._imageDirectory(this.baseFilename)}variantFilename(t="",e){return(e=e?e.toLowerCase():this.fileExtensionByVariant[t])&&this.baseFilename+"_"+(t||"orig")+"."+e}variantFilepath(t,e){const s=this.variantFilename(t,e);return s&&this.imageDirectory()+s}codedFilename(){let t=[this.baseFilename],e={};for(const t in this.fileExtensionByVariant){const s=this.fileExtensionByVariant[t];e[s]||(e[s]=[]),e[s].push(t||"orig")}for(const s in e){const r=e[s];t.push(r.join(",")+"."+s)}return t.join("/")}static fromCodedFilename(t){const e=t.split("/"),s=new this(e[0]);for(let t=1;t<e.length;t++){const[r,i]=e[t].split(".");for(const t of r.split(","))s.addVariant(t,i)}return s}toHDImage(){const t=this.constructor.hdImageTemplate,e=new O;return e.sizes=t.sizes.map((t=>{const e=this.variantFilepath(t.width===this.constructor.variantWidths[0]?void 0:t.width);return e&&new C(t.width,t.height,e)})).filter((t=>t)),e}}class k extends x{static imageTypeDir="user/avatar/";static variantWidths=[180,90,45];static aspectRatio=1}class _ extends x{static imageTypeDir="post/";static variantWidths=[3840,1780,890,400]}class D{id;username;avatar;profileUrl(){return PATH_TO_WEB_ROOT+"@"+this.username}avatarSrc(t,e){if(this.avatar)return k.fromCodedFilename(this.avatar).toHDImage().selectSize(t,e).src}static createFromObject(t){return t instanceof this?t:E.assignOwnProperties(new this,t)}}class P{taskAborted=!1;taskStarted=!1;taskCompleted=!1;taskExecutor;promise;constructor(t){this.taskExecutor=t}abort(t){if(!this.taskCompleted&&!this.taskAborted){this.taskAborted=!0;for(let e=this.callablesOnAbort.length-1;e>=0;e--)this.callablesOnAbort[e].call(void 0,t);this.complete()}}complete(){if(!this.taskCompleted){this.taskCompleted=!0;for(const t of this.callablesOnComplete)t()}}callablesOnAbort=[];onAbort(t){this.taskAborted?t.call():this.callablesOnAbort.push(t)}offAbort(t){y.arrayRemove(this.callablesOnAbort,t)}callablesOnComplete=[];onComplete(t){this.taskCompleted?t.call():this.callablesOnComplete.push(t)}offComplete(t){y.arrayRemove(this.callablesOnComplete,t)}run(t=this,...e){if(this.taskAborted||this.taskStarted||this.taskCompleted)return!1;this.taskStarted=!0;let s=this.promise=new Promise(((s,r)=>{this.onAbort((t=>r("Task aborted: "+t))),this.taskExecutor.call(t,s,r,...e)}));return s.then((()=>{this.complete()}),(t=>{this.abort("Promise rejected externally: "+t)})),s}}class S{abortables={};abortAll(t){y.forOwn(this.abortables,((e,s)=>{s&&s.abort(t)}))}}class Portal extends(function(t){t??=class{};const e=t;return e.isHasCustomEventsType?e:class extends t{static isHasCustomEventsType=!0;events={};on(t,e){if(e){if(!Object.values(this.events).includes(t))throw"Tried to bind to non-existing eventType";-1===t.indexOf(e)&&t.push(e)}}off(t,e){if(e){if(!Object.values(this.events).includes(t))throw"Tried to unbind to non-existing eventType";return y.arrayRemove(t,e)}}callEvent(t,...e){if(!Object.values(this.events).includes(t))throw"Tried to call non-existing eventType";for(const s of t)s(...e)}unbindAllEventCallbacks(){for(const t of Object.keys(this.events))this.events[t]=[]}}}(S)){itemData=[];items;filteredItems;itemsById={};columns;$canvas;$canvasInner;recalcDefaultImgLoadSensitivity(){return Math.max(1e3,this.scrollParentHeight)}static defaultSettings={fetchSize:50,imgLoadSensitivity:window.innerHeight,mode:void 0,excludeItemIds:{},videoHoverPlayDelay:!1};settings;activeFilters={};state;timers;abortables={pendingItemFetch:void 0};events={portalEmpty:[],modifyRequestData:[],beforePortalRemoved:[]};calc={top:0,bottom:0,availableWidth:void 0,stdImgWidth:void 0};constructor({$container:t,settings:e={},fullyLoaded:s,activeFilters:r,initItemData:i}={}){super(),this.items=[],this.columns=[],this.filteredItems=[];const o=this.$canvas=$("<div />").addClass("portalCanvas").appendTo(t);this.$canvasInner=$("<div />").appendTo(o),this.$emptyPortalContent=$("<div />").appendTo(o);const a=E.getScrollParent(o[0]);this.$scrollParent=$(a);let n,l,h=!1,c=!1,d=Math.floor(1e3/30),m=()=>{this.settings.imgLoadSensitivity=this.recalcDefaultImgLoadSensitivity(),this.fixCanvas(),l&&l.restore(),Date.now()-n>d&&(clearInterval(c),l=void 0,this.recalcAllItemTopOffset(),this.loadUnloadedItems(),c=!1)};this.scrollParentResizeObserver=new ResizeObserver((t=>{let e;t.forEach((t=>{const s=y.resizeObserverEntryToDimensions(t);e=s[0],this.scrollParentHeight=s[1]})),h||(h=!0,a.addEventListener("scroll",this._handleParentScroll,{passive:!0}),this.fixCanvas(!0,!0),o.on("mouseenter",".iWrap",(function(){let t=$(this);t.hasClass("placeholder")||t.data("portalItem").hoverOn()})),o.on("mouseleave",".iWrap",(function(){let t=$(this);t.hasClass("placeholder")||t.data("portalItem").hoverOff()})),this.loadCachedItemData(i),this.runScrollCheck()),n=Date.now(),l||this.$scrollParent.scrollTop()>this.calc.top&&e!==this.scrollParentWidth&&(l=this.bookmarkOffsetOfItemInViewport()),this.scrollParentWidth=e,c||(c=setInterval(m,d))})),this.scrollParentResizeObserver.observe(a===window?document.body:a);let u=e.excludeItemIds??{};if(Array.isArray(u)){let t={};for(const e of u)t[e]=!0;e.excludeItemIds=t}else"object"==typeof u&&(e.excludeItemIds=u);this.settings=e,Object.setPrototypeOf(this.settings,Portal.defaultSettings),this.activeFilters=r,this.state={fullyLoaded:s,rebuilding:!1}}_handleParentScroll=t=>{this.runScrollCheck()};itemIdHiddenOrRemoved(t){return this.settings.excludeItemIds[t]}remove(){this.removed||(this.callEvent(this.events.beforePortalRemoved),this.$scrollParent[0].removeEventListener("scroll",this._handleParentScroll),this.scrollParentResizeObserver.disconnect(),this.empty(),this.$canvas.remove(),this.unbindAllEventCallbacks(),E.dereferenceObject(this),this.removed=!0)}empty(t=!0){if(!t)for(const t of this.filteredItems)t.detach();for(const t of this.columns)t.remove();if(this.columns=[],this.$canvasInner.empty(),this.calc.bottom=0,t){for(const t of this.items)t.dispose();this.state.fullyLoaded=!1,this.itemData=[],this.items=[],this.filteredItems=[]}}refresh(){this.empty(),this.fixCanvas(!0,!0),this.runScrollCheck()}loadUnloadedItems(t,e){t??=this.settings.imgLoadSensitivity,e??=this.$scrollParent.scrollTop();var s=this.scrollParentHeight+e;for(const r of this.columns)for(const i of r.unloadedItems){const r=i.topOffset(),o=i.bottomOffset();(r>=e&&r<=s+t||o<=s&&o>=e-t)&&i.loadSmall()}}shouldFetchItems(t){return!this.state.fullyLoaded&&(t??=this.$scrollParent.scrollTop(),this.scrollParentHeight+t+2*this.settings.imgLoadSensitivity>=this.calc.bottom)}runScrollCheck(t){this.loadUnloadedItems(null,t),this.shouldFetchItems(t)&&this.fetchMoreItems()}globalMargins=3;fixCanvas(t=!1,e=!1){let s,r=this,i=this.$canvas.width(),o=this.globalMargins;if(!t&&i===this.calc.availableWidth)return;let a=this.calc.availableWidth=i;s=a<=200?Math.floor(a/3):a<=450?Math.floor(a/4):150;let n=this.calc.stdImgWidth=Math.min(i,(i+o)/Math.floor(i/(s+o))-o);var l=Math.ceil(a/(n+o)),h=i,c=Math.ceil(n)-n,d=t||l!==this.columns.length;d&&this.empty(!1);for(var m=0,u=0,p=0;m<l;m++)!function(t,e){if(u+c>0){var s=Math.floor(n);u-=c}else{s=Math.ceil(n);u+=c}p+=s,e?p!=h&&(s+=h-p):p+=o,d?r.addColumn(new z(r,s,0==t||t==l-1,t==l-1)):r.columns[t].setWidth(s)}(m,m==l-1);if(this.$canvasInner.css({width:h+"px"}),this.calcTop(),d){this.$canvasInner.append($("<div />").addClass("clear")),this.filteredItems=[];for(const t of this.items)this.appendItem(t);for(const t of this.columns)t.flushNewItems(!1)}else for(const t of this.filteredItems)t.init(null,!1);this.calcBottom(),e||this.checkEmptyPortal()}checkEmptyPortal(){this.filteredItems.length||this.abortables.pendingItemFetch?this.$emptyPortalContent.empty():this.callEvent(this.events.portalEmpty,this)}setEmptyPortalContent(t){this.$emptyPortalContent.empty().append($("<div />").addClass("px-6 py-[5vh] text-center font-semibold text-gray-500").append($(`<img src="${PATH_TO_WEB_ROOT}images/icons/no-content.png" class="no-content-icon" />`),t))}recalcAllItemTopOffset(){this.filteredItems.forEach((t=>t.calcTopOffsetRelativeToPortalTop()))}addColumn(t){this.columns.push(t)}appendItem(t){if(!this.itemIdHiddenOrRemoved(t.id)){this.filteredItems.push(t);for(var e=this.columns[0].height,s=0,r=1;r<this.columns.length;r++)this.columns[r].height<e&&(e=this.columns[r].height,s=r);this.columns[s].addItem(t)}}addItems(t){if(!t)return!1;this.calcTop();for(const e of t)this.items.push(e),this.itemsById[e.id]=e,this.appendItem(e);for(const t of this.columns)t.flushNewItems();this.calcBottom(),this.checkEmptyPortal()}calcTop(){let t=this.$canvasInner.offset().top+this.$scrollParent.scrollTop()-this.$scrollParent.offset().top;this.calc.top=t}calcBottom(){let t=this.$canvasInner.height();this.calc.bottom=this.calc.top+t}calcTopAndBottom(){this.calcTop(),this.calcBottom()}loadCachedItemData(t){if(t){const{itemData:e,fullyLoaded:s}=t;e.length&&this.addItemsFromData(e),s&&(this.state.fullyLoaded=!0)}}addItemsFromData(t){const e=t.filter((t=>t.postItems?.length));return this.itemData=[...this.itemData,...e],this.addItems(e.map((t=>F.createItem(t))))}fetchMoreItems(){if(this.abortables.pendingItemFetch)return this.abortables.pendingItemFetch;{this.filteredItems.length<1&&this.$canvas.addClass("loading");var t={mode:this.settings.mode,limit:this.settings.fetchSize,nsfwVisibility:0,twitchAuth:X};let e=this.items[this.items.length-1],s=e?.sortVal;switch(void 0!==s?(t.after=s,t.afterId=e.id):t.start=this.items.length,t.mode){case"user":case"user-likes":t.userId=this.activeFilters.userId;break;case"collection":t.collectionId=this.activeFilters.collectionId;break;default:t.mode=""}this.callEvent(this.events.modifyRequestData,t);let r=this.abortables.pendingItemFetch=new P(((e,s)=>{let i=E.ajax(PATH_TO_WEB_ROOT+"ajax/fetchPosts.php",{data:t,success:t=>{this.$canvas&&(this.$canvas.removeClass("loading"),t.data.items.length>0?(this.addItemsFromData(t.data.items),t.data.endOfResults&&(this.state.fullyLoaded=!0),this.runScrollCheck()):(this.state.fullyLoaded=!0,this.checkEmptyPortal())),e()},ajaxError:(t,e,r)=>{s("ajax error "+e+": "+r)}});r.onAbort((t=>{i.abort()}))}));return r.onComplete((()=>{this.abortables&&(this.abortables.pendingItemFetch=void 0),this.checkEmptyPortal()})),r.run(),r}}getItemById(t){return this.itemsById[t]}getItemOffsetRelativeToViewportTop(t,e){return e??=this.$scrollParent.scrollTop(),t.topOffset()-e}bookmarkOffsetOfItemInViewport(){let t=this.$scrollParent.scrollTop(),e=this.scrollParentHeight+t,s=E.binarySearchArray(this.filteredItems,null,((s,r)=>{const i=r.topOffset();return i>=t&&i<=e?0:t-i}));if(s>=0){let t=this.filteredItems[s],e=this.getItemOffsetRelativeToViewportTop(t);return{restore:()=>{t.calcTopOffsetRelativeToPortalTop(),this.$scrollParent.scrollTop(t.topOffset()-e)},portal:this}}}}class z{parentPortal;items=[];unloadedItems=[];edgeCol;lastCol;width=0;height=0;$el;newItems=[];$fragment;constructor(t,e,s,r){this.parentPortal=t,this.edgeCol=s,this.lastCol=r,this.$el=$("<div />").addClass("col").appendTo(t.$canvasInner),this.$fragment=$(document.createDocumentFragment()),this.setWidth(e),r&&this.$el.addClass("last")}setWidth(t){this.width=t,this.$el.css("width",t+"px")}remove(){this.$el.remove(),E.dereferenceObject(this)}addItem(t){this.items.push(t),this.newItems.push(t),this.appendItem(t)}appendItem(t){t.init(this),this.$fragment.append(t.$el),t.constrainedHeight&&(this.height+=t.constrainedHeight)}flushNewItems(t=!0){let e=this.newItems;this.$el.append(this.$fragment);let s=this.items.length-e.length;e.forEach(((e,r)=>{t&&e.calcTopOffsetRelativeToPortalTop(),s+r<=5?e.loadSmall():this.unloadedItems.push(e)})),this.newItems=[],this.$fragment=$(document.createDocumentFragment())}}class R{constructor(t){const{type:e,width:s,height:r}=t;this.type=e,this.width=s,this.height=r}static fromArray(t){return t.map((t=>"image"===t.type?new M(t):"video"===t.type?new W(t):void 0))}}class M extends R{constructor(t){super(t),this.image=_.fromCodedFilename(t.image)}}class W extends R{constructor(t){super(t);const{poster:e}=t;this.poster=e}}class F{id;sortVal;layout;postItems;get width(){return this.postItems[0].width}get height(){return this.postItems[0].height}parentColumn;parentPortal;constrainedWidth;constrainedHeight;$iWrap;$bWrap;$img;$imgInner;state={hovering:!1};static createItem(t){switch(t.postItems[0].type){case"image":return new A(t);case"video":return new L(t)}}constructor(t){let{id:e,sortVal:s,layout:r,postItems:i}=t;this.id=e,this.sortVal=s,this.layout=r,this.postItems=R.fromArray(i)}get $el(){return this.$iWrap}init(t,e){t=t??this.parentColumn,e=e??!this.$el,this.parentColumn=t,this.parentPortal=t.parentPortal;let s=this.width,r=this.height,i=this.constrainedWidth=t.width,o=this.constrainedHeight=Math.floor(i/s*r*10)/10;if(e){const t=["iWrap","loading"];this.postItems.length>1&&t.push("multi-item-post");let e=this.$bWrap=$("<div />").addClass("bWrap");this.$iWrap=$(`<a href="${this.url()}" class="${t.join(" ")}" target="_blank"></a>`).append(e).data("portalItem",this)}this.$iWrap.css({width:i+"px",height:o+"px"}).toggleClass("top",1===t.items.length)}topOffsetRelativeToPortalTop;topOffset(){let t=this.parentPortal?.calc.top+this.topOffsetRelativeToPortalTop;return NaN===t?void 0:t}bottomOffset(){const t=this.topOffset();if(void 0!==t)return t+this.constrainedHeight}detach(){this.$el.detach()}unassignPortalReferences(){this.parentColumn=void 0,this.parentPortal=void 0}dispose(){this.unassignPortalReferences(),this.$iWrap=void 0,this.$bWrap=void 0,this.$img=void 0,this.$imgInner=void 0}static itemUrl(t){return PATH_TO_WEB_ROOT+"i/"+t}url(){return F.itemUrl(this.id)}async loadSmall(t=!0){}calcTopOffsetRelativeToPortalTop(){this.topOffsetRelativeToPortalTop=this.$iWrap.offset().top-this.parentPortal.calc.top}hoverOn(){if(this.state.hovering)return!1;this.state.hovering=!0}hoverOff(){if(!this.state.hovering)return!1;this.state.hovering=!1}}class A extends F{smallSrc;constructor(t){super(t),this.smallSrc=this.image.variantFilepath(400)}get image(){return this.postItems[0].image}init(t,e){e=e??!this.$el,super.init(t,e),e&&(this.$imgInner=$('<div class="img-inner" />'),this.$img=$('<div class="img portal-image" />').append(this.$imgInner),this.$bWrap.append(this.$img)),this.$img.css({width:this.constrainedWidth+"px",height:this.constrainedHeight+"px"})}async loadSmall(t=!0){if(this.$iWrap?.hasClass("loading")){await E.preloadImgWithPromise(this.smallSrc);if(!this.$img)return;this.$imgInner.css("background-image","url("+this.smallSrc+")"),t&&this.$iWrap.addClass("transitionOpacity"),this.$iWrap.removeClass("loading")}}}class L extends F{isVideo=!0;$poster;get posterSrc(){return this.postItems[0].poster}init(t,e){e=e??!this.$el,super.init(t,e),e&&(this.$imgInner=$('<div class="img-inner" />'),this.$img=$('<div class="img portal-video" />').append(this.$imgInner),this.$bWrap.append(this.$img)),this.$img.css({width:this.constrainedWidth+"px",height:this.constrainedHeight+"px"})}dispose(){super.dispose(),this.$poster=void 0}async loadSmall(t=!0){if(this.posterSrc&&!this.$poster){let e=this.$poster=$('<div class="iOverlay video-poster"></div>');E.preloadImgWithPromise(this.posterSrc).then((()=>{this.$iWrap&&(t&&this.$iWrap.addClass("transitionOpacity"),e.css("background-image","url("+this.posterSrc+")").appendTo(this.$imgInner),this.$iWrap.removeClass("loading"))})).catch((()=>0))}}}function j(t){const e=class extends(function(t){return"resizeObservedElements"in t?t:class extends t{static get resizeObservedElements(){return this._resizeObservedElements||(this._resizeObservedElements=new Map),this._resizeObservedElements}static emitResizeEventEnabled=!0;static handleObservedResize(t,e){this.emitResizeEventEnabled&&t?.dispatchEvent(new CustomEvent("dt-resize",{detail:{width:e[0],height:e[1]}}))}static get resizeObserver(){return this._resizeObserver||(this._resizeObserver=new ResizeObserver((t=>{const e=new Map;t.forEach((t=>{e.set(t.target,y.resizeObserverEntryToDimensions(t))})),e.forEach(((t,e)=>{const s=this.resizeObservedElements.get(e);this.handleObservedResize(s,t)}))}))),this._resizeObserver}resizeObservableEl(){return this}observeResize(){const t=this.constructor,e=this.resizeObservableEl();e&&!t.resizeObservedElements.has(e)&&(t.resizeObserver.observe(e),t.resizeObservedElements.set(e,this))}unobserveResize(){const t=this.constructor,e=this.resizeObservableEl();e&&(t.resizeObserver.unobserve(e),t.resizeObservedElements.delete(e),t.resizeObservedElements.size<1&&(t._resizeObservedElements=void 0,t._resizeObserver=void 0))}connectedCallback(){super.connectedCallback(),this.observeResize()}disconnectedCallback(){super.disconnectedCallback(),this.unobserveResize()}}}(t)){static properties=Object.assign({},super.properties,{_renderedWidth:{state:!0},_renderedHeight:{state:!0}});constructor(){super(),this._renderedWidth,this._renderedHeight}static emitResizeEventEnabled=!1;static handleObservedResize(t,e){t&&(t._renderedWidth=e[0],t._renderedHeight=e[1]),super.handleObservedResize(t,e)}};return"resizeObservedElements"in t?t:e}class V extends a{static _tagNameMap=new Map;static registerTag(t){this._tagNameMap.set(this,t),customElements.define(t,this)}static get tagName(){return this._tagNameMap.get(this)}async ready(t=!1){const e=await this.updateComplete;if(!t)return e;const s=await Promise.all(Array.from(y.getDuckTypedDescendants(this,"updateComplete"),(t=>"function"==typeof t.ready?t.ready(!0):t.updateComplete)).filter((t=>!!t)));return e&&s.every((t=>!!t))}captureState(t){const e={};for(const s of t)e[s]=this[s];return e}restoreState(t){y.forOwn(t,((t,e)=>{this[t]=e}))}}class H extends V{createRenderRoot(){return this}}class B extends H{static properties={label:{},message:{}};constructor(){super(),this.label,this.message}static async create(t,e){const s=Object.assign(new this,{label:t,message:e});document.body.append(s),await s.ready(),s.querySelector("sl-dialog").show()}render(){return n`
					<sl-dialog label=${this.label} class="dialog-overview" @sl-after-hide=${()=>this.remove()}>
						${this.message}
						<sl-button slot="footer" class="dt-button dt-button-primary" @click=${t=>t.target.closest("sl-dialog").hide()}>Ok</sl-button>
					</sl-dialog>
				`}}B.registerTag("dt-alert-dialog");class q extends H{static properties={label:{}};focus(){this.querySelector(":scope > button")?.focus()}renderLabel(){if(this.label)return"function"==typeof this.label?this.label():this.label}}class U extends q{static properties=Object.assign(super.properties,{done:{state:!0}});constructor(){super(),this.label="Submit",this.done=!1}_handleClick(){this.querySelector(".hidden-submit")?.click()}render(){return n`
					<input type="submit" class="hidden-submit" />
					<button type="button" class="submit button rounded-lg" @click=${this._handleClick}>
						<div>
							${this.done?b():""}
							${this.renderLabel()}
						</div>
					</button>
				`}}U.registerTag("dt-submit-button");(class extends q{constructor(){super(),this.label="Cancel"}handleClick(){this.dispatchEvent(new CustomEvent("dt-cancel"))}render(){return n`
					<button type="button" class="cancel button rounded-lg" @click=${this.handleClick}>
						<div>
							${this.renderLabel()}
						</div>
					</button>
				`}}).registerTag("dt-cancel-button");class N extends(j(H)){static properties=Object.assign({},super.properties,{user:{state:!0},community:{state:!0},image:{},label:{},size:{},loading:{},defaultMode:{},hoverDarken:{attribute:"hover-darken",type:Boolean}});constructor(){super(),this.loading="eager",this.user,this.image,this.defaultMode}getDefaultMode(){return this.defaultMode?this.defaultMode:this.user?"smiley":void 0}_seedMap={};seed(t=""){return this.user?this.user.id+this.user.username+t:this._seedMap[t]??(this._seedMap[t]=1e5*Math.random())}get avatarSrc(){return this.image?this.image:this.user?.avatar?this._renderedWidth&&this._renderedHeight?this.user.avatarSrc(this._renderedWidth,this._renderedHeight):"":void 0}generateGradientSvg(t=!1){return"initial"===this.getDefaultMode()?o(this.seed("gradient")+"",t?.75:.7,t?.74:.8):o(this.seed("gradient")+"",t?.98:1,t?.9:.95)}generatedStyle(){const t=["--dt-avatar-bg: transparent"];return this.size&&t.push("--size: "+this.size),t.join("; ")||void 0}_icon;render(){let t,e;void 0!==this.avatarSrc?t=n`<div slot="icon"></div>`:"initial"===this.getDefaultMode()?e=this.user?.username[0]:"smiley"===this.getDefaultMode()&&(this._icon?t=this._icon:(t=n`<div slot="icon"></div>`,fetch(`${PATH_TO_WEB_ROOT}images/svg/smileys/${y.seedRandom(this.seed("39"),38).toFixed()}.svg`).then((t=>t.text())).then((t=>{this._icon=n`
										<div slot="icon" class="seedvatar">${l(t)}</div>
									`,this.requestUpdate()}))));const s=(t=!1)=>{if(void 0===this.avatarSrc)return n`
							<div class="default-avatar-bg ${t?"dark":""} absolute inset-0">
								${l(this.generateGradientSvg(t))}
							</div>
						`};return n`
					<div class="inline-flex relative">
						${s()}
						${this.hoverDarken?s(!0):void 0}
						<sl-avatar
							.loading=${this.loading}
							.image=${this.avatarSrc}
							.initials=${e}
							style="${u(this.generatedStyle())}"
							class="relative"
						>
							${t}
						</sl-avatar>
					</div>
				`}}N.registerTag("dt-avatar");class G extends(i(H)){static properties={confirmDisconnectRequired:{state:!0}};formController=new I(this);constructor(){super(),this.confirmDisconnectRequired,this.formController.handleFormSubmit((()=>{if(rt())this.confirmDisconnectRequired=!0;else{(this.openedLoginWindow=window.open(PATH_TO_WEB_ROOT+"twext/login.php?origin="+encodeURIComponent(window.origin),"DtTwextLoginWindow","width=380,height=600,location=yes,menubar=no,toolbar=no,status=no,resizable=no,scrollbars=yes")).addEventListener("close",(()=>this.openedLoginWindow=void 0))}}))}connectedCallback(){super.connectedCallback(),window.addEventListener("message",this._handleLoginWindowMessage)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("message",this._handleLoginWindowMessage)}postToLoginWindow(t,e){this.openedLoginWindow?.postMessage({dtMessageFlag:!0,action:t,...e??{}},"https://domo.town")}async handleLoginWindowMessage(t){const e=t.data,s=this.openedLoginWindow;if("https://domo.town"===t.origin&&t.source===s&&e.dtMessageFlag)switch(e.action){case"dt-login-page-ready":await Z,this.postToLoginWindow("twitch-auth-data",{twitchAuth:X});break;case"dt-handle-login":e.user&&(st.value=D.createFromObject(e.user)),s?.close()}}_handleLoginWindowMessage=t=>this.handleLoginWindowMessage(t);_handleDialogHideClick(t){t.target.closest("sl-dialog").hide()}_handleConfirmAccountDisconnectClick(t){E.ajax(PATH_TO_WEB_ROOT+"twext/ajax/disconnectTwitchExtensionUser.php",{data:{twitchAuth:X},success:()=>{st.value=!1}}),this._handleDialogHideClick(t)}_slDialogRef(t){t&&this.ready().then((()=>t.show()))}render(){if(!tt.value)return;const t=rt();return void 0!==t?t?n`
						<form ${this.formController.attach()}>
							<h2 class="flex items-center text-xl font-semibold mb-3">
								<div>Connected to DomoTown</div>
								${b("w-9 h-9 stroke-[5]")}
							</h2>
							<div
								class="flex flex-col items-stretch space-y-3
									md:flex-row md:space-y-0 md:justify-start md:space-x-3 md:items-center"
							>
								<div class="inline-flex items-center bg-gray-200 dark:bg-gray-800 px-2 py-1.5 pr-5 rounded-xl">
									<dt-avatar
										.user=${t}
										size="2.5rem"
									></dt-avatar>
									<div class="username ml-2.5 text-lg text-gray-900 dark:text-white font-bold">
										@${t.username}
									</div>
								</div>
								<dt-submit-button label="Disconnect" class="inline-block"></dt-submit-button>
							</div>
							<div class="mt-10">
								<h2 class="text-xl font-semibold mb-3">Extension Preview</h2>
								<dt-twext-panel class="block overflow-hidden border border-zinc-200 dark:border-zinc-800" style="height: 500px; width: 320px;"></dt-twext-panel>
							</div>
						</form>
						${this.confirmDisconnectRequired?n`
							<sl-dialog ${e.ref(this._slDialogRef)}
								label="Are You Sure?"
								class="dialog-overview"
								@sl-after-hide=${()=>this.confirmDisconnectRequired=!1}
							>
								Disconnect your DomoTown account from this extension?
								<div slot="footer">
									<sl-button class="dt-button dt-button-cancel" @click=${this._handleDialogHideClick}>Cancel</sl-button>
									<sl-button class="dt-button dt-button-primary" @click=${this._handleConfirmAccountDisconnectClick}>Confirm</sl-button>
								</div>
							</sl-dialog>
						`:""}
					`:n`
						<form ${this.formController.attach()}>
							<dt-submit-button label="Connect to DomoTown" class="inline-block"></dt-submit-button>
						</form>
					`:void 0}}G.registerTag("dt-twext-config");(class extends H{static properties={userId:{state:!0}};initItemData;constructor(){super(),this.userId}connectedCallback(){super.connectedCallback(),this.createPortal()}disconnectedCallback(){super.disconnectedCallback(),this.portal?.remove(),this.portal=void 0}createPortal(t={}){return this.portal||(t.$container=t.$container??this,t.settings=t.settings??{},t.settings.mode="user",t.activeFilters=t.activeFilters??{},t.activeFilters.userId=this.userId,this.initItemData&&(t.initItemData=this.initItemData,this.initItemData=void 0),this.portal=new Portal(t),this.portal.on(this.portal.events.beforePortalRemoved,(()=>this.portal=void 0)),this.portal.on(this.portal.events.portalEmpty,(t=>{const s=document.createElement("div");e.render(n`
							This user hasn&rsquo;t shared any public posts yet.
						`,s),t.setEmptyPortalContent(s)}))),this.portal}}).registerTag("dt-panel-portal");class Y extends(i(H)){static properties={confirmDisconnectRequired:{state:!0}};constructor(){super(),this.classList.add("max-h-full","overflow-hidden","flex","flex-col")}render(){if(!tt.value)return;const t=rt();return t?n`
						<a
							href=${t?.profileUrl()??"#"}
							class="flex items-center p-3 px-2.5
								font-semibold
								shrink-0"
							style="font-family: 'Montserrat', sans-serif"
							target="_blank"
						>
							<dt-avatar .user=${t} class="mr-1.5" size="2.5rem"></dt-avatar>
							<div>
								<b class="font-bold">@${t?.username}</b>&rsquo;s Art Feed
							</div>
						</a>
						<dt-panel-portal .userId=${t.id} class="overflow-y-auto overflow-x-hidden grow"></dt-panel-portal>
					`:void 0}}let X,J,K;Y.registerTag("dt-twext-panel");const Q=Twitch.ext,Z=new Promise((t=>{J=t})),tt=r.signal(void 0),et=r.signal(Q.configuration),st=r.signal(void 0);function rt(){return K||(K=new Promise((async(t,e)=>{await Z,E.ajax(PATH_TO_WEB_ROOT+"twext/ajax/getTwitchBroadcasterDtUser.php",{data:{twitchAuth:X},success:s=>{const r=s.data.user;if(r){const e=D.createFromObject(r);t(e)}else e()},anyError:t=>{e()}})})),K.then((t=>{st.value=t})).catch((()=>{st.value=!1}))),st.value}Q.onContext(((t,e)=>{if(e.includes("theme")){const e="dark"===t.theme;document.body.classList.toggle("dark",e),document.body.classList.toggle("sl-theme-dark",e)}})),Q.onAuthorized((t=>{tt.value=X=t,J()})),Q.configuration.onChanged((()=>{const{broadcaster:t,developer:e,global:s}=Q.configuration;et.value={broadcaster:t,developer:e,global:s}}));let it=portl.cmd||[];it.push((function(){E.init()})),Object.setPrototypeOf(portl,E),portl.Lit=e;const ot=function(t){if(void 0===t.called)try{t.call(),t.called=!0}catch(t){console.log("portl: Error processing command: ",t)}};for(const t of it)ot(t);portl.cmd={push:ot}}());